clear all;
clc;  % 导入附件3图像矩阵
syms h;
for i=0:208
    if i<10
        t=strcat('00',int2str(i),'.bmp');
        cell{1,i+1}=imread(strcat('E:\大学资料\2019年国赛数模\Text 2019.8.5\cumcm2013\B\附件3\',t));
    else if i<100
        t=strcat('0',int2str(i),'.bmp');
        cell{1,i+1}=imread(strcat('E:\大学资料\2019年国赛数模\Text 2019.8.5\cumcm2013\B\附件3\',t));
        else
            t=strcat(int2str(i),'.bmp');
        cell{1,i+1}=imread(strcat('E:\大学资料\2019年国赛数模\Text 2019.8.5\cumcm2013\B\附件3\',t));
        end
    end
end
for i=1:209
level=graythresh(cell{1,i});
% graythresh是一个函数，
% 功能是使用最大类间方差法找到图片的一个合适的阈值。
% 利用这个阈值通常比人为设定的阈值能更好地把一张灰度图像转换为二值图像。
cell1{1,i}=im2bw(cell{1,i},level);  %图像二值化处理
end
sum=zeros(209,180);
for i=1:209
    for j=1:180
        for k=1:72
            sum(i,j)=sum(i,j)+cell1{i}(j,k);
        end
    end
end
sum1=zeros(209,180);
for i=1:209
    for j=1:180
            if sum(i,j)==72
                sum1(i,j)=1;
           
            else
                sum1(i,j)=0;
            end
    end
end
% Y=pdist(sum1,'euclidean');
% Z=linkage(Y,'single');
% C=cophenet(Z,Y);
% T=cluster(Z,11);

load test3.mat
s1=zeros(209,1);
s2=zeros(209,1);
h=1;
b=1;
for j=1:209
    for i=20:180
    if sum1(j,i)==0
        if h==1
            s1(j,1)=i;
            b=j;
            h=0;
        end
    end
    if sum1(b,i)==1&&h==0
        h=1;
        s2(j,1)=i;
        break;
    end
          % a=a+1;
    end
end
a=1;
%误差
%kmeans聚类
for i=1:209
s3(i,1)=(s1(i,1)+s2(i,1))/2;
end
idx=kmeans(s3,11);
d=1;
for i=1:11
for j=1:209
if idx(j)==i
    d1(i,d)=j;
    d=d+1;
end
end
d=1;
end
%聚类得：
% 9	10	25	26	36	39	47	75	82	89	104	106	123	131	149	162	168	190	194	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0
% 1	35	43	44	48	59	78	85	91	95	98	113	122	125	128	137	145	150	165	184	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0
% 6	11	30	38	45	49	56	60	65	76	93	99	105	112	172	173	181	202	207	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0
% 15	90	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0
% 2	19	24	27	31	42	51	63	77	87	88	101	121	143	148	169	180	192	196	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0
% 14	16	17	18	22	28	34	61	67	81	84	86	107	110	111	126	133	134	140	146	151	153	157	158	166	171	174	182	183	185	188	198	199	201	203	205	206
% 7	8	20	21	33	37	46	53	54	57	62	64	68	69	70	71	73	79	80	94	97	100	117	127	132	138	139	154	159	163	164	167	175	176	178	197	209
% 5	41	102	103	109	114	115	118	120	124	141	147	152	155	156	186	195	208	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0
% 3	12	23	29	50	55	58	66	92	96	119	130	142	144	179	187	189	191	193	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0
% 4	13	32	40	52	74	83	108	116	129	135	136	160	161	170	177	200	204	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0
% 72	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0

%对中间的两组进行再聚类
s5=[7	8	20	21	33	37	46	53	54	57	62	64	68	69	70	71	73	79	80	94	97	100	117	127	132	138	139	154	159	163	164	167	175	176	178	197	209];
for i=1:37 %collections in 6 lines.
s6(i,1)=s3(s5(i),1);
end
idx1=kmeans(s6,2);
d2=1;
for i=1:2
for j=1:37
if idx1(j)==i
    d3(i,d2)=j;
    d2=d2+1;
end
end
d2=1;
end
s7=[7	8	20	21	33	37	46	53	54	57	62	64	68	69	70	71	73	79	80	94	97	100	117	127	132	138	139	154	159	163	164	167	175	176	178	197	209];
for i=1:37
s8(i,1)=s3(s7(i),1);
end
idx2=kmeans(s8,2);
d4=1;
for i=1:2
for j=1:37
if idx1(j)==i
    d5(i,d4)=j;
    d4=d4+1;
end
end
d4=1;
end
%经过整理得到的聚类数据为
new1{1}=[8 209 139 159   127    69   176    46 175   138    54    57    94   154    71   167    33   197];
new1{2}=[ 129 4 160 83 200 136 13 74 161 204 170 135 40 32 52 108 116 177];
new1{3}=[30    65   112   202     6    93   181    49    38    76    56    45   207    11   105    99   173   172    60];
new1{4}=[39   149    47 162    25    36  82   190   123   104   131   194    89   168    26     9  10 106 75];
new1{5}=[50    55    66   144   187     3    58   193   179   119   191    96   130    29    92   189   142    12    23];
new1{6}=[62    20    79    68    70   100   163    97   132    80 64 117 164    73     7   178    21    53    37];
new1{7}=[ 157    84    133   201   18    81   34   203   199    16   134   171    206    86    153   166   28    61];
new1{8}=[ 147   103   155   115    41   152   208   156   141   186   109 118 5   102   114   195 120 124];
new1{9}=[1 95    35    85   184    91    48   122    43   125 145    78   113   150    98   137   165   128 59    44];
new1{10}=[126    14   183   110   198    17    185   111   188   67   107   151   22   174   158   182    205   140   146];
new1{11}=[169   101    77    63   143    31    42    24   148   192    51   180   121    87   196    27     2    88   19];
new1{12}=[15 90];
new1{13}=[72];
%人工干预改变4个数的位置
new{1}=[8 209 139 159 127 69 176 46 175 1 138 54 57 94 154 71 167 33 197];
new{2}=[15 129 4 160 83 200 136 13 74 161 204 170 135 40 32 52 108 116 177];%
new{3}=[30 65 112 202 6 93 181 49 38 76 56 45 207 11 105 99 173 172 60];
new{4}=[39 149 47 162 25 36 82 190 123 104 131 194 89 168 26 9 10 106 75];
new{5}=[50 55 66 144 187 3 58 193 179 119 191 96 130 29 92 189 142 12 23];
new{6}=[62 20 79 68 70 100 163 97 132 80 64 117 164 73 7 178 21 53 37];
new{7}=[72 157 84 133 201 18 81 34 203 199 16 134 171 206 86 153 166 28 61];%
new{8}=[90 147 103 155 115 41 152 208 156 141 186 109 118 5 102 114 195 120 124];%
new{9}=[95 35 85 184 91 48 122 43 125 145 78 113 150 98 137 165 128 59 44];%
new{10}=[126 14 183 110 198 17 185 111 188 67 107 151 22 174 158 182 205 140 146];
new{11}=[169 101 77 63 143 31 42 24 148 192 51 180 121 87 196 27 2 88 19];
%at=[];
%    for j=1:19
%            k=new{1,9}(j);
%            k=k-1;
%            disp(k)
%            if k<10
%                t=strcat('00',int2str(k),'.bmp');
%                at=[at imread(strcat('E:\大学资料\2019年国赛数模\Text 2019.8.5\cumcm2013\B\附件3\',t))];
%            elseif k>=10 && k<100
%                t=strcat('0',int2str(k),'.bmp');
%                at=[at imread(strcat('E:\大学资料\2019年国赛数模\Text 2019.8.5\cumcm2013\B\附件3\',t))];
%            else
%                t=strcat(int2str(k),'.bmp');
%                at=[at imread(strcat('E:\大学资料\2019年国赛数模\Text 2019.8.5\cumcm2013\B\附件3\',t))];
%            j=j+1;
%            end
%    end
%        b=[at(1:180,1:72),at(1:180,73:144),at(1:180,145:217),at(1:180,218:289),at(1:180,290:361),at(1:180,362:433),at(1:180,434:505),at(1:180,506:580),at(1:180,581:652),at(1:180,653:724),at(1:180,725:796),at(1:180,797:868),at(1:180,869:940),at(1:180,941:1012),at(1:180,1013:1083),at(1:180,1084:1156),at(1:180,1157:1228),at(1:180,1229:1300),at(1:180,1301:1368)];
%        imshow(b)
%        saveas(gcf,'9.bmp')
at=[];b=cell(1,11);
for i=1:11
    for j=1:19
        k=new{1,i}(j);
        k=k-1;
        if k<10
            t=strcat('00',int2str(k),'.bmp');
            at=[at imread(strcat('E:\大学资料\2019年国赛数模\Text 2019.8.5\cumcm2013\B\附件3\',t))];
        elseif k>=10 && k<100
            t=strcat('0',int2str(k),'.bmp');
            at=[at imread(strcat('E:\大学资料\2019年国赛数模\Text 2019.8.5\cumcm2013\B\附件3\',t))];
        else
            t=strcat(int2str(k),'.bmp');
            at=[at imread(strcat('E:\大学资料\2019年国赛数模\Text 2019.8.5\cumcm2013\B\附件3\',t))];
        j=j+1;
        end
    end
        b{1,i}=[at(1:180,1:72),at(1:180,73:144),at(1:180,145:217),at(1:180,218:289),at(1:180,290:361),at(1:180,362:433),at(1:180,434:505),at(1:180,506:580),at(1:180,581:652),at(1:180,653:724),at(1:180,725:796),at(1:180,797:868),at(1:180,869:940),at(1:180,941:1012),at(1:180,1013:1083),at(1:180,1084:1156),at(1:180,1157:1228),at(1:180,1229:1300)];
        at=[];
        i=i+1;
end
c=[];
for i=1:11
    c=[c;b{1,test3(i)}];
end
imshow(c);
